<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla Curricular Medicina UBA</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f4ff;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #4a4e69;
    }

    .container {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 20px;
    }

    .column {
      min-width: 250px;
      background-color: #e0e8ff;
      padding: 10px;
      border-radius: 10px;
      flex-shrink: 0;
    }

    .column h2 {
      color: #6a4c93;
      text-align: center;
    }

    .subject {
      background-color: #d3e0ff;
      margin: 8px 0;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s;
    }

    .subject.locked {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .subject:hover:not(.locked) {
      background-color: #c0d4ff;
    }

    .subject input[type="number"] {
      width: 40px;
      margin-left: 10px;
      border: none;
      border-radius: 4px;
      padding: 2px 4px;
    }

    .tooltip {
      position: absolute;
      top: 0;
      left: 100%;
      background-color: #444;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      white-space: nowrap;
      display: none;
      font-size: 12px;
      margin-left: 10px;
    }

    .subject.locked:hover .tooltip {
      display: block;
    }

    .approved {
      text-decoration: line-through;
      background-color: #a3e4d7 !important;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular Medicina (UBA)</h1>
  <div class="container" id="curriculum"></div>

  <script>
    const materias = [
      {
        ciclo: "CBC",
        materias: [
          { nombre: "Int. Pensamiento Científico", id: "ipc" },
          { nombre: "Int. Con. Sociedad y Estado", id: "icsye" },
          { nombre: "Química", id: "quimica" },
          { nombre: "Biofísica", id: "biofisica_cbc" },
          { nombre: "Biología Celular", id: "biocel" },
          { nombre: "Matemática", id: "mate" },
        ]
      },
      {
        ciclo: "Ciclo Biomédico - 1er Año",
        materias: [
          { nombre: "Anatomía", id: "anatomia", requisitos: ["ipc", "icsye", "quimica", "biofisica_cbc", "biocel", "mate"] },
          { nombre: "Histología", id: "histologia", requisitos: ["ipc", "icsye", "quimica", "biofisica_cbc", "biocel", "mate"] },
          { nombre: "Embriología", id: "embrio", requisitos: ["ipc", "icsye", "quimica", "biofisica_cbc", "biocel", "mate"] },
          { nombre: "Genética", id: "genetica", requisitos: ["ipc", "icsye", "quimica", "biofisica_cbc", "biocel", "mate"] },
          { nombre: "Salud Mental", id: "saludmental", requisitos: ["ipc", "icsye", "quimica", "biofisica_cbc", "biocel", "mate"] },
          { nombre: "Salud Pública", id: "saludpub", requisitos: ["ipc", "icsye", "quimica", "biofisica_cbc", "biocel", "mate"] },
          { nombre: "Bioética", id: "bioetica", requisitos: ["ipc", "icsye", "quimica", "biofisica_cbc", "biocel", "mate"] },
          { nombre: "Inglés Técnico", id: "ingles" },
        ]
      },
      {
        ciclo: "Ciclo Biomédico - 2do Año",
        materias: [
          { nombre: "Fisiología y Biofísica", id: "fisiobio", requisitos: ["anatomia", "histologia", "genetica", "embrio"] },
          { nombre: "Bioquímica", id: "bioquimica", requisitos: ["anatomia", "histologia", "genetica", "embrio"] },
          { nombre: "Inmunología", id: "inmuno", requisitos: ["anatomia", "histologia", "genetica", "embrio"] },
          { nombre: "Microbiología", id: "micro", requisitos: ["bioquimica", "inmuno"] },
        ]
      },
      {
        ciclo: "Ciclo Clínico",
        materias: [
          { nombre: "Medicina A", id: "meda", requisitos: ["fisiobio", "bioquimica", "inmuno", "micro", "saludmental", "saludpub", "bioetica"] },
          { nombre: "Patología", id: "patologia", requisitos: ["fisiobio", "bioquimica", "inmuno", "micro"] },
          { nombre: "Farmacología", id: "farma1", requisitos: ["fisiobio", "bioquimica", "inmuno", "micro"] },
          { nombre: "Medicina Legal y Deontología Médica", id: "legal", requisitos: ["meda"] },
          { nombre: "Toxicología", id: "tox", requisitos: ["farma1"] },
          { nombre: "Farmacología II", id: "farma2", requisitos: ["farma1", "meda"] },
        ]
      },
      {
        ciclo: "Clínicas y Quirúrgicas",
        materias: [
          { nombre: "Medicina B", id: "medb", requisitos: ["meda", "patologia"] },
          { nombre: "Nutrición", id: "nutri", requisitos: ["meda", "patologia"] },
          { nombre: "Dermatología", id: "derma", requisitos: ["meda", "patologia"] },
          { nombre: "Infectología", id: "infecto", requisitos: ["meda", "patologia"] },
          { nombre: "Neumonología", id: "neumo", requisitos: ["meda", "patologia"] },
          { nombre: "Neurología", id: "neuro", requisitos: ["meda", "patologia"] },
          { nombre: "Diagnóstico por imágenes", id: "imagen", requisitos: ["meda", "patologia"] },
          { nombre: "Psiquiatría", id: "psiq", requisitos: ["saludmental"] },
          { nombre: "Pediatría", id: "pedia" },
          { nombre: "Obstetricia", id: "obste" },
          { nombre: "Ginecología", id: "gine" },
          { nombre: "Cirugía General", id: "cirugia" },
          { nombre: "Urología", id: "uro" },
          { nombre: "Ortopedia - Traumatología", id: "trauma" },
          { nombre: "Oftalmología", id: "oftalmo" },
          { nombre: "Otorrinolaringología", id: "otorrino" },
          { nombre: "Neurocirugía", id: "neuroc" },
        ]
      },
      {
        ciclo: "Práctica Final Obligatoria",
        materias: [
          { nombre: "Medicina Familiar", id: "fam", requisitos: ["medb", "cirugia"] },
          { nombre: "Emergentología", id: "emerge", requisitos: ["medb", "cirugia"] },
          { nombre: "Prácticas comunitarias", id: "comunitarias", requisitos: ["medb", "cirugia"] },
        ]
      },
      {
        ciclo: "Rotaciones Especiales",
        materias: [
          { nombre: "Dermatología", id: "r_derma" },
          { nombre: "Psiquiatría", id: "r_psiq" },
          { nombre: "Pediatría", id: "r_pedia" },
          { nombre: "Neurología", id: "r_neuro" },
          { nombre: "Oftalmología", id: "r_oftalmo" },
          { nombre: "Gastroenterología", id: "r_gastro" },
          { nombre: "Cirugía General", id: "r_cirugia" },
          { nombre: "Toxicología", id: "r_tox" },
          { nombre: "Neumonología", id: "r_neumo" },
          { nombre: "Traumatología", id: "r_trauma" },
          { nombre: "Geriatría", id: "r_geriatria" },
          { nombre: "Endocrinología", id: "r_endo" },
          { nombre: "Cardiología", id: "r_cardio" },
          { nombre: "Neurocirugía", id: "r_neuroc" },
          { nombre: "Tocoginecología", id: "r_toco" },
          { nombre: "Infectología", id: "r_infecto" },
          { nombre: "Terapia intensiva", id: "r_terapia" },
          { nombre: "Otorrinolaringología", id: "r_otorrino" },
          { nombre: "Patología", id: "r_pato" },
          { nombre: "Nutrición", id: "r_nutri" },
          { nombre: "Oncología", id: "r_onco" },
          { nombre: "Urología", id: "r_uro" },
          { nombre: "Clínica Médica", id: "r_clinica" },
          { nombre: "Hematología", id: "r_hema" },
        ]
      }
    ];

    function guardarEstado() {
      localStorage.setItem("materias_aprobadas", JSON.stringify(estado));
    }

    function cargarEstado() {
      const data = localStorage.getItem("materias_aprobadas");
      return data ? JSON.parse(data) : {};
    }

    const estado = cargarEstado();

    function crearMateria(materia) {
      const div = document.createElement("div");
      div.className = "subject";
      div.id = materia.id;

      const aprobada = estado[materia.id]?.aprobada;
      const nota = estado[materia.id]?.nota || "";

      const requisitos = materia.requisitos || [];

      const faltan = requisitos.filter(r => !estado[r]?.aprobada);
      if (faltan.length > 0) {
        div.classList.add("locked");
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        tooltip.innerText = "Requiere: " + faltan.join(", ");
        div.appendChild(tooltip);
      } else if (aprobada) {
        div.classList.add("approved");
      }

      div.innerHTML += `<span>${materia.nombre}</span>
        <input type="number" min="4" max="10" placeholder="Nota" value="${nota}"/>`;

      div.addEventListener("click", (e) => {
        if (div.classList.contains("locked")) return;
        if (e.target.tagName === "INPUT") return;

        const yaAprobada = div.classList.toggle("approved");
        estado[materia.id] = estado[materia.id] || {};
        estado[materia.id].aprobada = yaAprobada;
        guardarEstado();
        location.reload(); // para recalcular dependencias
      });

      div.querySelector("input").addEventListener("change", (e) => {
        estado[materia.id] = estado[materia.id] || {};
        estado[materia.id].nota = e.target.value;
        guardarEstado();
      });

      return div;
    }

    function renderMalla() {
      const contenedor = document.getElementById("curriculum");
      materias.forEach(bloque => {
        const col = document.createElement("div");
        col.className = "column";
        col.innerHTML = `<h2>${bloque.ciclo}</h2>`;
        bloque.materias.forEach(mat => {
          const m = crearMateria(mat);
          col.appendChild(m);
        });
        contenedor.appendChild(col);
      });
    }

    renderMalla();
  </script>
</body>
</html>
